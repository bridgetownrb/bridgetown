---
published: false
title: Supercharge Your Bridgetown Site with Ruby Front Matter
subtitle: You can now write real Ruby code directly in your Front Matter! This feature is available for pages, posts, and other documents‚Äìas well as layouts for site-wide access to your Ruby return values.
author: jared
category: feature
calculation: !ruby/string:Rb |
  [2 * 4, 5 + 2].min
title_fragment: Title of a Page
example_title: !ruby/string:Rb |
  "This is the #{data["title_fragment"].sub("Title", "Name")}"
seo_tag_gem_version: !ruby/string:Rb |
  url = "https://raw.githubusercontent.com/bridgetownrb/bridgetown-seo-tag/master/lib/bridgetown-seo-tag/version.rb"
  result = Faraday.get(url).body
  result.match(/VERSION = "(.*?)"/)[1]
---

Starting in Bridgetown v0.13, you can now write real Ruby code directly in your [Front Matter](https://www.bridgetownrb.com/docs/front-matter/)! ü§Ø This feature is available for pages, posts, and other documents‚Äìas well as layouts for site-wide access to your Ruby return values.

{% rendercontent "docs/note" %}
This requires the environment variable `BRIDGETOWN_RUBY_IN_FRONT_MATTER` to be set to `"true"` in your development and deployment setups. Otherwise the code will not be executed and will be treated as a raw string.
{% endrendercontent %}

Now you may be wondering, how is this even possible? Front Matter is in YAML format, and the only place you can write actual code is in a custom plugin, right? RIGHT??

Well‚Ä¶it just so happens that there's this nifty bit of the YAML specification which allows for serialization and deserialization of objects. Normally that functionality is _switched off_ in Bridgetown for security reasons. But we figured out a way to punch a hole through this security barrier to allow for a special type of string that represents Ruby code. It looks like this:

{% raw %}
```ruby
---
title: I'm a page
permalink: /ruby-demo
calculation: !ruby/string:Rb |
  [2 * 4, 5 + 2].min
---

Title: {{ page.title }}
Calc Result: {{ page.calculation }}
```
{% endraw %}

In this example, the value of the `calculation` variable is the return value of the Ruby code, contained with the special spring indicated by the `!ruby/string:Rb` tag. The `|` symbol at the end just means all the indented code in the lines below are attached to that front matter variable. 

The value that then is printed out in the rendered page for the calculation will be **{{ page.calculation }}** (since 7 is less than 8 and thus the minimum integer in the array). In fact, on this very page you're reading, that number **{{ page.calculation }}** is actually being generated by Ruby Front Matter, not hard-coded in the documentation! Thus you know the system works. ‚ò∫Ô∏è

In the Ruby Front Matter you can return any kind of value that is accessible from the Liquid template. So strings, numbers, arrays, hashes, integers: they all work. Even _objects_ can be returned if they are [implemented as a Liquid drop](https://github.com/Shopify/liquid/wiki/Introduction-to-Drops).

You can also access other Front Matter variables from within the Ruby code itself.

```ruby
---
title_fragment: Title of a Page
title: !ruby/string:Rb |
  "This is the #{data["title_fragment"].sub("Title", "Name")}"
---
```

Now the page title will read: **{{ page.example_title }}**

### Use Cases for Ruby Front Matter

One particularly compelling use case for Ruby Front Matter is to load data in from a third-party source for inclusion on a page (typically in JSON format, but it could be anything really). Here's an example of loading a file from a remote GitHub repository and parsing it to obtain useful information:

```ruby
seo_tag_gem_version: !ruby/string:Rb |
  url = "https://raw.githubusercontent.com/bridgetownrb/bridgetown-seo-tag/master/lib/bridgetown-seo-tag/version.rb"
  result = Faraday.get(url).body
  result.match(/VERSION = "(.*?)"/)[1]
```

That will pull the current version of the master branch from the bridgetown-seo-tag gem and output it via {% raw %}`{{ page.seo_tag_gem_version }}`{% endraw %}  (it's **v{{ page.seo_tag_gem_version }}**).

Another example is a feature we include on very website to show the average number of commits to the Bridgetown project on GitHub over the past month. (At the time this site was last build, that number is **{{ layout.github_participation }}**.)

Here's the Ruby Front Matter we included in `_layouts/default.html`:

```ruby
---
github_participation: !ruby/string:Rb |
  require "faraday"
  endpoint = "https://api.github.com/repos/bridgetownrb/bridgetown/stats/participation"

  resp = Faraday.get(
    endpoint,
    nil,
    {"Accept": "application/vnd.github.v3+json"}
  )
  json = JSON.parse(resp.body)
  json["all"][-4..].sum
---
<!doctype html>
‚Ä¶etc‚Ä¶
```

Then in our footer (or anywhere on the site), we can simply add {% raw %}`{{ layout.github_participation }}`{% endraw %} to output that value.

### Takeaways and a Security Caveat

If you need to write a lot of code, or write code that is easily customizable or reusable in various contexts, it's still recommended to write a Bridgetown plugin‚Äîeither in the `plugins` folder in your site repo or as a separate Gem-based plugin.

But if you just need to add a little bit of dynamic functionality to a page or a layout and like being able to see the code and content combined into a single file, Ruby Front Matter is a powerful and immensely flexible solution.

And remember, this isn't a "lite" or stripped-down version of Ruby. This is 100% full Ruby. So you can instantiate objects, require gems, perform network requests, interact with the underlying filesystem, monkeypatch and metaprogram and do anything you'd ever need to do.

{% rendercontent "docs/note", type: "warning" %}
For security reasons, do _not_ allow untrusted content into your repository and executed in an unsafe environment (aka outside of a Docker container or similar). Just like with custom plugins, a malicious content contributor could potentially introduce harmful code into your site and thus computer system. Enable Ruby Front Matter _only_ if you feel confident in your ability to control and monitor all site repository files and data.
{% endrendercontent %}

So if you're excited to give Ruby Front Matter a try, install Bridgetown v0.13 or later, set `BRIDGETOWN_RUBY_IN_FRONT_MATTER` to `"true` in your development environment, and go to town (Bridge‚Ä¶town üòã). And be sure to share your sweet solutions on Twitter with the hashtag **\#SpinUpBridgetown** to let us know what you've built with Ruby Front Matter!

